<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chess Coach</title>

    <!-- Board CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessground@8.3.3/assets/chessground.base.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessground@8.3.3/assets/chessground.brown.css">

    <!-- Piece CSS -->
    <link id="piece-set-css" rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/lichess-org/lila@master/public/piece-css/cburnett.css">

    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/4/45/Chess_plt45.svg" type="image/svg+xml">
    <!-- PeerJS for WebRTC -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>

<body>

    <div class="container">
        <div id="board" class="board is2d"></div>

        <div class="sidebar">
            <!-- Fixed Top Section (Clocks & Essential Info) -->
            <div class="sidebar-top">
                <div class="chess-clock-panel" id="chessClockPanel">
                    <div class="clock-display">
                        <div class="clock-player" id="whiteClockPlayer">
                            <div class="clock-player-label">White</div>
                            <div class="clock-time" id="whiteClock">10:00</div>
                        </div>
                        <div class="clock-player" id="blackClockPlayer">
                            <div class="clock-player-label">Black</div>
                            <div class="clock-time" id="blackClock">10:00</div>
                        </div>
                    </div>
                </div>

                <div class="essential-info">
                    <div id="status">White to move</div>
                    <div id="ratingBadge" class="rating-badge" style="display: none;">
                        <span class="rating-icon">üìä</span>
                        <span id="ratingValue">~800</span>
                    </div>
                </div>

                <div id="evaluation-bar">
                    <div id="eval-fill"></div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="play">üéÆ Play</button>
                <button class="sidebar-tab" data-tab="analysis">üß† Analysis</button>
                <button class="sidebar-tab" data-tab="settings">‚öôÔ∏è Settings</button>
                <button class="sidebar-tab" data-tab="community">üë• Community</button>
            </div>

            <!-- Tab Content Area -->
            <div class="tab-content">
                <!-- PLAY TAB -->
                <div class="tab-panel active" id="tab-play">
                    <!-- Action Buttons - Moved up for accessibility -->
                    <div class="button-group compact">
                        <button id="resetBtn" class="primary-btn" title="Start a fresh new game">New Game</button>
                        <button id="undoBtn" title="Undo the last move">Undo</button>
                        <button id="flipBtn" title="Flip the board to play from the other side">Flip</button>
                    </div>

                    <div id="feedback" class="feedback-box">
                        Make a move to get coaching...
                    </div>

                    <button id="continueBtn" class="continue-btn" style="display: none;">
                        Ignore & Continue Game
                    </button>

                    <div class="move-history-panel">
                        <div class="move-history-header">
                            <h3>Move History</h3>
                            <div class="game-controls">
                                <button id="saveGameBtn" class="icon-btn"
                                    title="Save current game to browser storage">üíæ</button>
                                <button id="loadGameBtn" class="icon-btn"
                                    title="Load a previously saved game">üìÇ</button>
                                <button id="exportPgnBtn" class="icon-btn" title="Save game as a PGN file">üì§</button>
                                <button id="importPgnBtn" class="icon-btn"
                                    title="Import game from a PGN file">üì•</button>
                            </div>
                        </div>
                        <div id="move-list" class="move-list">
                            <div class="move-list-empty">No moves yet</div>
                        </div>
                    </div>

                    <button id="learningDashboardBtn" class="learning-btn">
                        üìä Learning Dashboard
                    </button>
                </div>

                <!-- ANALYSIS TAB -->
                <div class="tab-panel" id="tab-analysis">
                    <!-- Mate Detection Alert -->
                    <div id="mateAlert" class="mate-alert" style="display: none;">
                        <div class="mate-icon">üéØ</div>
                        <div class="mate-info">
                            <div class="mate-title">Mate in <span id="mateInMoves">0</span>!</div>
                            <div class="mate-side" id="mateSide">White is winning</div>
                        </div>
                    </div>

                    <!-- Win Probability Display -->
                    <div id="winProbability" class="win-probability-panel" style="display: none;">
                        <div class="win-prob-header">Win Probability</div>
                        <div class="win-prob-bars">
                            <div class="win-prob-label white">
                                <span>White</span>
                                <span id="whiteWinPercent">50%</span>
                            </div>
                            <div class="win-prob-bar-container">
                                <div class="win-prob-bar white" id="whiteWinBar" style="width: 50%"></div>
                                <div class="win-prob-bar black" id="blackWinBar" style="width: 50%"></div>
                            </div>
                            <div class="win-prob-label black">
                                <span>Black</span>
                                <span id="blackWinPercent">50%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Streaming Analysis Panel -->
                    <div id="streamingAnalysis" class="streaming-analysis-panel" style="display: none;">
                        <div class="streaming-header">
                            <span>üîÑ Live Analysis</span>
                            <span class="cloud-badge">Cloud</span>
                        </div>
                        <div class="depth-progress">
                            <div class="depth-label">Depth: <span id="currentDepth">0</span>/<span id="maxDepth">18</span></div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="depthProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="streaming-eval">
                            <div class="eval-label">Evaluation:</div>
                            <div class="eval-value" id="streamingEval">+0.00</div>
                        </div>
                        <div class="streaming-continuation">
                            <div class="continuation-label">Best line:</div>
                            <div class="continuation-moves" id="streamingContinuation">-</div>
                        </div>
                    </div>

                    <!-- Opening Information -->
                    <div class="opening-panel">
                        <div class="opening-header">
                            <div id="opening-name" class="opening-name">Starting Position</div>
                            <div class="opening-meta">
                                <span id="opening-eco" class="opening-eco"></span>
                                <span id="opening-category" class="opening-category"></span>
                            </div>
                        </div>
                        <div id="opening-variations" class="opening-variations"></div>
                    </div>

                    <!-- Analysis Tools -->
                    <div class="analysis-panel">
                        <h3>Analysis Tools</h3>
                        <div class="analysis-controls">
                            <button id="hintBtn" class="analysis-btn">üí° Get Hint</button>
                            <button id="analyzeBtn" class="analysis-btn">üîç Analyze</button>
                        </div>

                        <div id="bestMovesPanel" class="best-moves-panel" style="display: none;">
                            <div class="best-moves-header">Top Moves:</div>
                            <div id="bestMovesList" class="best-moves-list"></div>
                        </div>
                    </div>

                    <!-- Critical Moments & Puzzles -->
                    <div id="criticalMomentsPanel" class="critical-moments-panel" style="display: none;">
                        <h3>Critical Moments</h3>
                        <div id="criticalMomentsList" class="critical-moments-list"></div>
                    </div>

                    <div id="puzzlesPanel" class="puzzles-panel" style="display: none;">
                        <h3>Generated Puzzles</h3>
                        <div id="puzzlesList" class="puzzles-list"></div>
                    </div>
                </div>

                <!-- SETTINGS TAB -->
                <div class="tab-panel" id="tab-settings">
                    <div class="settings-section">
                        <h4>‚ö° Analysis Engine</h4>
                        <div class="engine-selector-panel">
                            <label class="engine-option">
                                <input type="radio" name="engine" value="local" id="engineLocal" checked>
                                <div class="engine-info">
                                    <div class="engine-name">üñ•Ô∏è Local Stockfish</div>
                                    <div class="engine-description">Private, works offline, uses your CPU</div>
                                </div>
                            </label>
                            <label class="engine-option">
                                <input type="radio" name="engine" value="cloud" id="engineCloud">
                                <div class="engine-info">
                                    <div class="engine-name">‚òÅÔ∏è Cloud API (80 MNPS)</div>
                                    <div class="engine-description">Instant analysis, zero CPU usage, requires internet</div>
                                </div>
                            </label>
                        </div>

                        <!-- Cloud-specific settings -->
                        <div id="cloudSettings" class="cloud-settings" style="display: none;">
                            <div class="control-group">
                                <label for="cloudDepth">
                                    Cloud Depth: <span id="cloudDepthValue">12</span>
                                </label>
                                <input type="range" id="cloudDepth" min="8" max="18" value="12" step="1">
                            </div>
                            <div class="control-group">
                                <label for="cloudVariants">
                                    Variants: <span id="cloudVariantsValue">3</span>
                                </label>
                                <input type="range" id="cloudVariants" min="1" max="5" value="3" step="1">
                            </div>
                            <div class="privacy-notice">
                                <small>‚ÑπÔ∏è Cloud analysis sends board positions to chess-api.com. No personal data is transmitted.</small>
                            </div>
                        </div>

                        <div id="engineStatus" class="engine-status">
                            <span class="status-indicator">‚ö´</span>
                            <span class="status-text">Engine: Not initialized</span>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h4>Game Settings</h4>
                        <div class="control-group">
                            <label class="toggle-switch-label">
                                <span>‚è±Ô∏è Enable Clock</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="clockEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                            <select id="clockPreset" class="clock-preset-select">
                                <option value="bullet_1">1+0 Bullet</option>
                                <option value="blitz_3">3+0 Blitz</option>
                                <option value="blitz_5">5+0 Blitz</option>
                                <option value="rapid_10" selected>10+0 Rapid</option>
                                <option value="classical_30">30+0 Classical</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="showHints" checked>
                                Pause & Explain Mistakes
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="analysisMode">
                                Analysis Mode (No AI)
                            </label>
                        </div>

                        <div class="control-group">
                            <label for="difficulty">Opponent Level:</label>
                            <select id="difficulty">
                                <option value="2">Easy</option>
                                <option value="6">Medium</option>
                                <option value="12">Hard</option>
                                <option value="18" selected>Master</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label for="analysisDepth">Analysis Depth:</label>
                            <select id="analysisDepth">
                                <option value="10">Fast</option>
                                <option value="15" selected>Balanced</option>
                                <option value="20">Deep</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h4>Appearance</h4>
                        <div class="control-group">
                            <label class="toggle-switch-label">
                                <span>üåô Dark Mode</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="darkModeToggle" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                        </div>

                        <div class="control-group">
                            <label for="boardTheme">Board:</label>
                            <select id="boardTheme">
                                <option value="brown">Brown</option>
                                <option value="blue">Blue</option>
                                <option value="green">Green</option>
                                <option value="marble">Marble</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label for="pieceSet">Pieces:</label>
                            <select id="pieceSet">
                                <option value="cburnett">Classic</option>
                                <option value="merida">Merida</option>
                                <option value="chess7">Chess7</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label for="boardSize">Board Size: <span id="boardSizeValue">600px</span></label>
                            <input type="range" id="boardSize" min="300" max="800" value="600" step="50">
                        </div>

                        <div class="control-group">
                            <label for="animationSpeed">Animation:</label>
                            <select id="animationSpeed">
                                <option value="instant">Instant</option>
                                <option value="fast">Fast</option>
                                <option value="normal" selected>Normal</option>
                                <option value="slow">Slow</option>
                            </select>
                        </div>

                        <div class="control-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="soundToggle" checked>
                                Sound Effects
                            </label>
                        </div>
                    </div>
                </div>

                <!-- COMMUNITY TAB -->
                <div class="tab-panel" id="tab-community">
                    <div class="community-section">
                        <h4>Local Play</h4>
                        <div class="control-group">
                            <label class="toggle-switch-label">
                                <span>üë• Pass & Play Mode</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="localMultiplayer">
                                    <span class="toggle-slider"></span>
                                </label>
                            </label>
                            <p class="section-hint">Play against a friend on the same device. Engine moves are disabled.
                            </p>
                        </div>
                    </div>

                    <div class="community-section">
                        <h4>Online Multiplayer (WebRTC)</h4>
                        <div id="onlineStatus" class="online-status disconnected">Disconnected</div>

                        <div class="multiplayer-controls">
                            <div id="connectionPanel">
                                <p class="section-hint">Your Peer ID:</p>
                                <div class="id-container">
                                    <code id="myPeerId">---</code>
                                    <button id="copyIdBtn" class="icon-btn" title="Copy ID">üìã</button>
                                </div>

                                <div class="connect-input-group">
                                    <input type="text" id="remotePeerId" placeholder="Friend's Peer ID">
                                    <button id="connectBtn" class="primary-btn">Connect</button>
                                </div>
                                <button id="shareLinkBtn" class="secondary-btn" style="margin-top: 10px; width: 100%;">
                                    üîó Copy Challenge Link
                                </button>
                            </div>

                            <div id="activeConnectionPanel" style="display: none;">
                                <div class="opponent-info">
                                    Connected to: <span id="connectedPeerId">---</span>
                                </div>
                                <button id="disconnectBtn" class="danger-btn">Disconnect</button>
                            </div>
                        </div>
                    </div>

                    <div class="community-section">
                        <h4>Local Leaderboard</h4>
                        <div id="leaderboardList" class="leaderboard-list">
                            <div class="leaderboard-empty">No games recorded yet</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Hidden file input for PGN import -->
    <input type="file" id="pgnFileInput" accept=".pgn" style="display: none;">

    <!-- Load Game Modal -->
    <div id="loadGameModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Load Saved Game</h3>
                <button id="closeModalBtn" class="close-btn">&times;</button>
            </div>
            <div id="savedGamesList" class="saved-games-list">
                <div class="no-games">No saved games found</div>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>

</body>

</html>